

<div class="container"> 

<h4 style="text-align:center;"> eBuy checkout list </h4>
<br/>
<br/>
  <table class="table">
          <% @line_items.each do |line_item| %>
                      <tr>
                        <td style="width:30%;">
                          <a href="#">
                           <img src="/assets/product_avatar.png" alt="image" title="image" class="img-thumbnail img-responsive" />
                          </a>
                        </td>
                        <td >
                          <a href="#">
                            <%= line_item.product.title %>
                          </a>
                        </td>
                        <td >x <%= line_item.quantity %></td>
                        <td ><%= (line_item.total_price) %> MMK</td>
                        <td ><%= link_to 'remove',line_item, method: :delete, data: { confirm: 'Are you sure?' } ,:class=>"btn btn-danger" %></td>
                      </tr>
         <% end %> 




  </table>
  <hr/>
  <br/>
  <div style="float:right;width:30%;">
    Total Price: <%= (@cart.total_price) %> MMK

    <br/> <br/>
    Coupon Code:
    <input id="coupon_code"   >
    <button class="btn btn-default" id="send_coupon"> use</button>
    <br/> <br/>
    Final Price:
    <input id="checkout_price" placeholder="checkout_price">
    <br/> <br/>
    <%= link_to 'Fill up order form', order_form_path, :class => "btn btn-primary"  %>
  </div>
  <br/>


</div>


  <br/>
  <br/>







<script type="text/javascript">
  
 $('#send_coupon').click(function() {
 

    coupon_code = document.getElementById("coupon_code").value;
    limitation = "<%= (@cart.total_price) %>";


      $.ajax({
              type: 'get',
              url: 'use_coupon',
              dataType: 'text',
              data: {'title':coupon_code, 'limitation':limitation},
              complete: function(r){
              
                  raw_discount_price = r.responseText;
                  clean_discount_price = raw_discount_price.replace('{:discount_price=>["', "");
                  discount_percent = clean_discount_price.replace('"]}', "");
                 
                  // couopon calculation
                  var percentage = parseFloat(discount_percent/100);
                  var descrease_amount =  parseInt(percentage*limitation);
                  var actual_amount = parseInt(limitation-descrease_amount)

                  document.getElementById("checkout_price").value = actual_amount;
         



              }
           });






    });


</script>